#!/bin/bash

if [ -z "${BUCKET_NAME}" ]; then
  echo "Error: BUCKET_NAME environment variable is not set!"
  exit 1
fi

# @see https://docs.infomaniak.cloud/block_storage/swissbackup/

export OS_AUTH_URL="{{ swiss_backup_location }}/identity/v3"
export OS_REGION_NAME="{{ swiss_backup_region }}"
export OS_PROJECT_NAME="{{ swiss_backup_project_name }}"
export OS_PASSWORD="{{ swiss_backup_password }}"
export OS_USER_DOMAIN_NAME=default
export OS_USERNAME="{{ swiss_backup_user_name }}"
export OS_PROJECT_DOMAIN_NAME=default
export RESTIC_REPOSITORY="swift:{{ swiss_backup_project_name }}:/${BUCKET_NAME}"
export RESTIC_PASSWORD="{{ restic_password }}"


restic "$@"
