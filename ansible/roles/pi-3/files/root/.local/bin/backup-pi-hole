#!/bin/bash

BACKUPS_DIR="/srv/backups"
BACKUP_DIR="${BACKUPS_DIR}/pi-hole"

mkdir -p "${BACKUP_DIR}"
cd "${BACKUP_DIR}" || exit 1
pihole-FTL --teleporter

# Ensure we never have more than 7 snapshots
find "${BACKUPS_DIR}" -type f -name "pi-hole_*.zip" -printf '%T+ %p\n' | sort | head -n -7 | awk '{print $2}' | xargs -I {} rm {}
